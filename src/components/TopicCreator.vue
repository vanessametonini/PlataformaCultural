<template>
  <div class="app-component stepper">
    <!-- header -->
    <header class="stepper-header">
      <logo-card />
      <progress-bar
        class="progressbar"
        :current-step="currentStep"
        :steps-title="stepsTitle"
      />
      <color-line class="color-line" />
    </header>
    <!-- content -->
    <div class="stepper-content">
      <!-- SECTION 1 -->
      <section
        v-if="currentStep === 1"
        id="section1"
        class="stepper-section"
      >
        <span class="title-3 bolder mg-top16">Sobre os Debates</span>
        <p class="body-2 mg-top8 justify-text">
          Voc√™ poder√° iniciar um debate sobre o assunto que desejar, seja ele endere√ßado
          para um grupo espec√≠fico (como por exemplos os colegiados setoriais)
          ou aberto a todos aqueles que estejam interessados em discutir assuntos relativos √† Cultura Municipal. 
          Ao iniciar um debate, voc√™ apresentar√° seu ponto de vista inserindo um pequeno texto argumentativo
          sobre o assunto e convidando pessoas a dialogar e compartilhar outros pontos de vista. 
        </p>
        <p class="body-2 mg-top8 justify-text">
          Para momentos de gera√ß√£o de ideias ou tomadas de decis√£o, a funcionalidade Debate √© bastante √∫til,
          pois a visualiza√ß√£o permite a organiza√ß√£o da informa√ß√£o e as curtidas e apoios auxiliam a entender
          quais ideias s√£o mais populares.
          Considere que o debate n√£o aciona nenhum mecanismo de atua√ß√£o concreta, mas alimenta as tomadas de 
          decis√£o do F√≥rum Municipal de Cultura de Campo Grande-MS, identifica as demandas da classe art√≠stica,
          verifica a necessidade de encontros espec√≠ficos (assembleias e reuni√µes), entre outras observa√ß√µes.
        </p>
        <span class="headline-3 bolder mg-top16">
          Recomenda√ß√µes para participar de um debate aberto
        </span>
        <p class="body-2 mg-top8 justify-text">
          1. Para iniciar um debate √© necess√°rio que voc√™ fa√ßa um cadastro na plataforma
          <router-link
            class="link body-2"
            to="/signUp"
          >
            <strong>Cartografia da Cultura</strong>
          </router-link>. Os usu√°rios cadastrados tamb√©m podem participar das discuss√µes j√°
          iniciadas atrav√©s dos coment√°rios e/ ou indicar se concorda ou n√£o
          concorda clicando nos bot√µes ‚Äú<span title="polegar pra cima / apoiar">üëç</span>‚Äù
          ou ‚Äú<span title="polegar pra baixo / n√£o apoiar">üëé</span>‚Äù encontrados em 
          cada debate proposto.
        </p>
        <p class="body-2 mg-top8 justify-text">
          2. Seja cuidadoso ao escrever com letras mai√∫sculas. Na Internet, muitas vezes isso √© considerado o mesmo que gritar.
        </p>
        <p class="body-2 mg-top8 justify-text">
          3. As cr√≠ticas duras s√£o bem vindas. Este √© um espa√ßo de pensamento
          livre, mas recomendamos que seja gentil.
        </p>
        <p class="body-2 mg-top8 justify-text">
          4. Desfrute deste espa√ßo, das vozes que o preenchem, ele tamb√©m √© seu.
        </p>
      </section>
      <!-- SECTION 2 -->
      <section
        v-if="currentStep === 2"
        id="section2"
        class="stepper-section"
      >
        <span class="title-1 bolder">Regras do debate aberto</span>
        <!-- 1 -->
        <span
          class="body-2 bolder mg-top16"
        >1. Uma vez feito o login, voc√™ poder√°:</span>
        <ol>
          <li class="body-2 justify-text">
            Iniciar um debate.
          </li>
          <li class="body-2 justify-text">
            Participar de um debate j√° iniciado.
          </li>
          <li class="body-2 justify-text">
            Apoiar ou n√£o apoiar um debate iniciado.
          </li>
        </ol>
        <!-- 2 -->
        <span class="body-2 bolder mg-top24">2. Para iniciar o debate: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            Insira um t√≠tulo curto que represente o assunto principal que voc√™ quer debater.
          </li>
          <li class="body-2 justify-text">
            Insira um pequeno texto apresentando sua argumenta√ß√£o. 
          </li>
          <li class="body-2 justify-text">
            Escolha uma categoria principal que melhor relaciona o assunto do debate.
            Outras categorias complementares tamb√©m podem ser inseridas.
          </li>
        </ol>
        <!-- 3 -->
        <span
          class="body-2 bolder mg-top24"
        >3. Uma vez iniciado o debate, voc√™ n√£o poder√°:
        </span>
        <ol class="list">
          <li class="body-2 justify-text">
            Deletar o debate que voc√™ iniciou;
          </li>
        </ol>
        <!-- 4 -->
        <span class="body-2 bolder mg-top24">4. Ser√£o deletados: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            Os coment√°rios ofensivos, com discurso de √≥dio ou qualquer ato de
            comunica√ß√£o que inferiorize ou incite contra uma pessoa ou grupo,
            tendo por base caracter√≠sticas como ra√ßa, g√™nero, etnia,
            nacionalidade, religi√£o, orienta√ß√£o sexual ou outro aspecto pass√≠vel
            de discrimina√ß√£o.
          </li>
          <li class="body-2 justify-text">
            Qualquer coment√°rio que implique em uma a√ß√£o ilegal ou que tenham a
            inten√ß√£o de sabotar o espa√ßo de debate.
          </li>
        </ol>
        <!-- 5 -->
        <span class="body-2 bolder mg-top24">5. Recomendamos que: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            Revise o texto que inserir no debate. Veja se est√° claro e objetivo.
          </li>
          <li class="body-2 justify-text">
            Seja gentil ao dialogar com as outras vozes que t√™m pontos de vista
            diferente do seu.
          </li>
        </ol>
        <!-- ACCEPT TERMS -->
        <div class="stepper-rules row al-items-center">
          <q-checkbox
            v-model="rulesAccepted"
            size="32px"
            color="black"
          >
            <span class="body-2 mg-left8">
              Eu li e concordo com as
              <strong
                style="cursor: pointer"
                @click="scrollToTop()"
              >
                Recomenda√ß√µes e regras do debate
              </strong>.*
            </span>
          </q-checkbox>
          <span
            class="caption mg-left8"
            :class="{ 'rules-accept-error': rulesError }"
          >(Esta op√ß√£o deve ser marcada*)</span>
        </div>
      </section>
      <!-- SECTION 3 -->
      <topic-form v-if="currentStep === 3" :editMode="false"></topic-form>
      <!-- TERMS -->
    <div v-if="currentStep === 3" class="stepper-terms row no-wrap al-items-center">
      <q-field
        borderless
        dense
        :value="terms"
        :error="$v.terms.$error"
        :error-message="termsErrorMessage"
        @blur="$v.terms.$touch"
      >
        <template #control>
          <q-checkbox
            v-model="terms"
            size="32px"
            color="black"
          >
            <span class="body-3 mg-left8">
              Eu li e concordo com os
              <router-link
                class="link"
                :to="{ path: '/terms', hash: '#terms' }"
                target="_blank"
              >
                <span class="body-3 bolder">Termos de Uso</span>
              </router-link>
              e
              <router-link
                class="link"
                :to="{ path: '/terms', hash: '#privacy' }"
                target="_blank"
              >
                <span class="body-3 bolder">Privacidade. *</span>
              </router-link>
            </span>
          </q-checkbox>
        </template>
      </q-field>
    </div>
    </div>
    <!-- FOOTER -->
    <div class="stepper-footer">
      <!-- BACK -->
      <base-button
        v-if="currentStep != 1"
        class="stepper-btn"
        theme="flat"
        @click="prevStep()"
      >
        <i class="fas fa-arrow-left btn-icon" />
        <span class="body-3 bolder stepper-btn-span mg-left16"> voltar </span>
      </base-button>
      <!-- CANCEL -->
      <base-button
        v-if="currentStep !== 2"
        class="stepper-btn"
        theme="flat"
        @click="cancel()"
      >
        <i class="fas fa-times btn-icon" />
        <span class="body-3 bolder stepper-btn-span text-uppercase mg-left16">
          cancelar
        </span>
      </base-button>
      <base-button
        v-if="currentStep != numberOfSteps"
        class="stepper-btn"
        theme="flat"
        @click="nextStep()"
      >
        <span class="body-3 bolder stepper-btn-span text-uppercase">
          Continuar
        </span>
        <i class="fas fa-arrow-right btn-icon mg-left16" />
      </base-button>
      <base-button
        v-if="currentStep === numberOfSteps"
        class="stepper-btn"
        @click="submit()"
      >
        <span class="body-3 bolder text-uppercase"> Iniciar debate </span>
      </base-button>
    </div>
  </div>
</template>

<script>
import { sameAs } from "vuelidate/lib/validators";
import { mapGetters } from "vuex";
import { createHelpers } from "vuex-map-fields";
import ColorLine from "./ColorLine.vue";
import ProgressBar from "./BaseStepProgressBar.vue";
import BaseButton from "./BaseButton.vue";
import TopicForm from './TopicForm.vue';

const { mapFields } = createHelpers({
  getterType: "topics/getField",
  mutationType: "topics/updateField",
});

export default {
  name: "TopicCreator",
  components: {
    ColorLine,
    ProgressBar,
    BaseButton,
    TopicForm,
  },
  data() {
    return {
      currentStep: 1,
      count: 0,
      numberOfSteps: 3,
      stepsTitle: ["O que s√£o os Debates", "Regras", "Crie seu Debate"],
      rulesAccepted: false,
      rulesError: false,
      terms: false,
      hasSelected: false,
    };
  },
  validations: {
    terms: {
      sameAs: sameAs( () => true )
    },
  },
  computed: {
    ...mapGetters({
      categories: "categories/loadCategories",
    }),
    termsErrorMessage() {
      return "√â necess√°rio aceitar os termos";
    },
  },
  methods: {
    async submit() {
      this.$v.$touch();
      if(!this.$v.$anyError) {
        this.$store
        .dispatch("topics/createNewTopic", { $socket: this.$socket })
        .then(() => {
          this.content = "";
          this.title = "";
          this.category = null;
          this.categoriesTagged = [];
          this.$router.push("/topics");
        });
      }
      else {
        this.$q.notify({
          message: "Por favor, preencha todos os campos para o debate",
          position: 'top-right',
        });
      }
    },
    cancel() {
      this.content = "";
      this.title = "";
      this.category = null;
      this.categoriesTagged = [];
      this.$router.push({ name: "Topics" });
    },
    nextStep() {
      if (this.currentStep === 2 && this.rulesAccepted === false) {
        this.rulesError = true;
      } else if (this.count <= this.numberOfSteps) {
        this.currentStep += 1;
        this.count += 1;
        this.scrollToTop();
        this.rulesError = false;
      }
    },
    prevStep() {
      if (this.count >= 0) {
        this.currentStep -= 1;
        this.count -= 1;
      }
      this.scrollToTop();
    },
    scrollToTop() {
      window.scrollTo({
        top: 0,
        left: 0,
        behavior: "smooth",
      });
    },
  },
};
</script>

<style lang="scss" scoped>
@import "../styles/variables.scss";
@import "../styles/mixins.scss";
@import '../styles/categories.scss';

$height: 32px;
$width: 32px;
$line-height: 32px;
$primaryColor: black;
$secondaryColor: #ddd;

.stepper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  justify-content: space-between;
  margin-bottom: 50px;
}

.stepper-header {
  width: 100%;
  padding: 16px;
  padding-bottom: 0;

  .progressbar {
    margin-top: 24px;
  }

  .identity {
    display: none;
    margin: 16px 0 32px 0;
  }

  .color-line {
    margin-top: 32px;
  }
}

.stepper-content {
  width: 100%;
  height: 100%;
  padding: 16px;
}

section {
  display: flex;
  flex-direction: column;
  opacity: 1;
  animation-name: fadeInOpacity;
  animation-iteration-count: 1;
  animation-timing-function: cubic-bezier(0.075, 0.82, 0.165, 1);
  animation-duration: 1s;
}

ol {
  list-style: lower-latin;
  margin: 8px 0 0 0;
  padding-left: 10px;
}

li {
  margin-left: 32px;
  margin-bottom: 8px;
}

.stepper-rules,
.stepper-terms {
  margin-top: 32px;
}

.rules-accept-error {
  animation: shake 0.2s;
  color: red;
}

@keyframes shake {
  0% {
    transform: translateX(0px);
  }
  25% {
    transform: translateX(-5px);
  }
  50% {
    transform: translateX(0px);
  }
  75% {
    transform: translateX(5px);
  }
  100% {
    transform: translateX(0px);
  }
}

.link {
  text-decoration: none;
  color: black;
}

.justify-text {
  text-align: justify;
}

.category-field {
  display: grid;
  grid-template-columns: repeat(2, 50%);
  margin-top: 32px;

  .category-list {
    border: 1px solid #ddd;
    padding: 0 8px;
    border-radius: 2px;
    margin-right: 32px;

    span[class^="icon-"] {
      font-size: 2em;
    }
  }
}

.related-tags,
.main-tag {
  border: 1px solid #ddd;
  padding: 0 8px;
  border-radius: 2px;
}

.main-tag {
  min-height: 56px;

  #label {
    margin-top: -4px;
    color: $gray3;
  }
}

.main-tag-badge {
  width: fit-content;
  border: 1px solid;
  padding: 4px 8px;
  border-radius: 2px;
  margin-top: 8px;
}

#untag {
  cursor: pointer;
  &:hover {
    transform: scale(1.1);
  }
}

.related-tags {
  margin-top: 32px;
  min-height: 100px;
}

.related-tags-grid {
  display: flex;
  flex-flow: row wrap;
  align-content: flex-start;
  margin-top: 8px;
}

.categorys-tags-badge {
  display: block;
  border: 1px solid;
  border-radius: 2px;
  height: min-content;
  padding: 2px 8px;
  margin:  0 8px 8px 0;
}

@keyframes fadeInOpacity {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

.titulo, .conteudo {
  margin-top: 4px;
  margin-bottom: 8px;
}

.editor {
  width: 100%;
}

.stepper-footer {
  width: 100%;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  justify-content: space-around;
  margin: 32px 0;
  padding: 0 16px;
  padding-bottom: 16px;
  border-bottom: 1px solid #ddd;
}

.stepper-btn {
  min-width: 150px;
  transition: 1s ease-in-out;
}

.btn-icon {
  color: $gray2;
}

.stepper-btn-span {
  color: $primaryColor !important;
  letter-spacing: 1px;
}
</style>
